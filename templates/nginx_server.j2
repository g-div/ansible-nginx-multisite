#Ansible managed

upstream {{ item.name }} {
	server 127.0.0.1:{{ item.port }};
}

server {
    listen   80;
    server_name {{ item.name }}.{{ domain }};
    root {{ folder }}/{{ item.static }};
    index index.html index.htm;
    location / {
    	try_files $uri $uri/ @backend;
    }
    location @backend {
    	proxy_set_header X-Real-IP  $remote_addr;
    	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    	proxy_pass http://{{ item.name }};
    }
}